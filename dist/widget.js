var RAWidget=function($){"use strict";const Z='@import"https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Manrope:wght@400;600;700&display=swap";:host{display:block;background:transparent}#ra{all:initial;--ra-text: #3d2a1f;--ra-muted: #7a6251;--ra-bg-card: #fff7f2;--ra-bg-soft: #fff1e8;--ra-border: #ffd8c2;--ra-border-strong: #ffb894;--ra-accent: #ff6b00;--ra-accent-dark: #e85d00;--ra-focus: rgba(77, 163, 255, .45);--ra-cream-shadow: rgba(255, 140, 64, .18);--ra-cream-glow: rgba(255, 107, 0, .16);--ra-overlay: rgba(0, 0, 0, .58);--ra-soft-white: #ffffff;font-family:Manrope,Inter,Segoe UI,system-ui,sans-serif;color:var(--ra-text);font-size:16px;line-height:1.5;width:100%;text-rendering:optimizeLegibility}#ra *,#ra *:before,#ra *:after{box-sizing:border-box}.ra360{position:relative;display:block;width:100%}.ra360 button{font-family:inherit;border-radius:14px;border:1px solid transparent;background:transparent;color:inherit;transition:box-shadow .25s ease,transform .25s ease,border-color .25s ease,background .25s ease}.ra360 button:focus-visible,.ra360 input:focus-visible,.ra360 select:focus-visible,.ra360 textarea:focus-visible{outline:3px solid var(--ra-focus);outline-offset:2px;box-shadow:0 0 0 4px #4da3ff26}.widget-card{position:relative;display:grid;justify-items:center;gap:14px;padding:28px 26px;border-radius:20px;border:1px solid var(--ra-border);background:var(--ra-bg-card);color:var(--ra-text);box-shadow:0 18px 40px var(--ra-cream-shadow);transition:transform .25s ease,box-shadow .25s ease;cursor:pointer;text-align:center}.widget-card:after{content:"";position:absolute;inset:0;border-radius:20px;border:2px solid transparent;transition:border-color .25s ease,box-shadow .25s ease}.widget-card:hover,.widget-card:focus-visible{transform:translateY(-4px);box-shadow:0 28px 56px #ff8c403d}.widget-card:focus-visible:after{border-color:#ff8c4073;box-shadow:0 0 0 6px #4da3ff38}.widget-card h3{margin:0;font-size:1.4rem;font-weight:700}.widget-card .card-subtitle{margin:0;font-size:.96rem;color:var(--ra-muted);max-width:28ch}.card-icon-trio{display:flex;gap:10px}.icon-pill{display:inline-flex;align-items:center;justify-content:center;width:46px;height:46px;border-radius:16px;background:var(--ra-bg-soft);border:1px solid var(--ra-border);color:var(--ra-accent);font-size:1.4rem}.widget-card .cta-inline{display:inline-flex;align-items:center;gap:6px;font-weight:700;color:var(--ra-accent);text-decoration:underline;text-decoration-thickness:2px;text-decoration-color:#ff6b008c}.modal-backdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:16px;background:var(--ra-overlay);backdrop-filter:blur(8px);z-index:99999;overflow:hidden}.modal-backdrop:before{content:"";position:absolute;inset:0;background:radial-gradient(circle at center,#4da3ff2e,#0009 60%);pointer-events:none}.modal-backdrop.open{display:flex;animation:fadeIn .25s ease}.modal{width:min(720px,100%);max-height:min(92vh,800px);background:var(--ra-soft-white);border-radius:24px;border:1px solid rgba(255,216,194,.9);box-shadow:0 0 0 8px #4da3ff26,0 28px 70px #00000026;display:flex;flex-direction:column;overflow:hidden;position:relative}.modal header{padding:26px 32px 20px;border-bottom:1px solid var(--ra-border);background:var(--ra-bg-soft)}.modal header h2{margin:0;font-size:1.45rem;font-weight:700;display:flex;align-items:center;gap:10px}.modal header p{margin:8px 0 0;color:var(--ra-muted);font-size:.96rem}.progress-bar{margin-top:18px;height:6px;width:100%;background:#ffd8c299;border-radius:999px;overflow:hidden}.progress-bar span{display:block;height:100%;width:0;background:linear-gradient(90deg,#ff9f4d,var(--ra-accent));border-radius:inherit;transition:width .35s ease}.progress-label{margin-top:8px;font-size:.9rem;color:var(--ra-muted);font-weight:600;text-align:right}.modal-close{position:absolute;top:16px;right:16px;width:40px;height:40px;border-radius:50%;border:1px solid var(--ra-border);background:#ffe6d2e6;color:var(--ra-accent);font-size:1.1rem;cursor:pointer;transition:background .2s ease,transform .2s ease}.modal-close:hover,.modal-close:focus-visible{background:#ffd6ba;transform:translateY(-1px)}.modal main{flex:1;overflow-y:auto;padding:28px 32px 32px;background:var(--ra-soft-white)}.step{display:none;animation:slideIn .35s ease}.step.active{display:block}.categories-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin:24px 0 20px}.category-option{position:relative;display:flex;flex-direction:column;gap:8px;padding:16px;border-radius:16px;border:1px solid var(--ra-border);background:var(--ra-bg-soft);color:inherit;text-align:left;font-weight:600;cursor:pointer;transition:transform .2s ease,border-color .2s ease,box-shadow .2s ease}.category-option .category-icon{font-size:1.8rem}.category-option span{font-size:.85rem;font-weight:500;color:var(--ra-accent)}.category-option.active{border-color:var(--ra-accent);background:var(--ra-bg-card);box-shadow:0 12px 30px var(--ra-cream-shadow);transform:translateY(-2px)}.category-option:focus-visible{outline:none;box-shadow:0 0 0 4px #4da3ff33}.primary-btn,.secondary-btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;border-radius:18px;padding:12px 26px;font-weight:700;cursor:pointer;border:1px solid transparent;transition:transform .2s ease,box-shadow .2s ease,background .2s ease,border-color .2s ease}.primary-btn{background:linear-gradient(180deg,#ff7a1a 0%,var(--ra-accent) 100%);color:#fff;border-color:var(--ra-border-strong);box-shadow:0 16px 34px #ff6b0047}.primary-btn:disabled{cursor:not-allowed;opacity:.55;box-shadow:none}.primary-btn:not(:disabled):hover,.primary-btn:not(:disabled):focus-visible{transform:translateY(-1px);box-shadow:0 20px 46px #ff6b005c}.secondary-btn{background:var(--ra-bg-soft);color:var(--ra-text);border-color:var(--ra-border)}.secondary-btn:hover,.secondary-btn:focus-visible{background:#ffe8da;box-shadow:0 10px 22px var(--ra-cream-shadow)}.step-actions{display:flex;flex-wrap:wrap;gap:12px;justify-content:flex-end;margin-top:28px}.question-header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:18px;color:var(--ra-muted);font-size:.95rem}.question-body{background:var(--ra-bg-card);border:1px solid var(--ra-border);border-radius:20px;padding:26px;display:grid;gap:18px;box-shadow:0 12px 28px var(--ra-cream-shadow)}.question-body h3{margin:0;font-size:1.18rem;color:var(--ra-text)}.question-options{display:grid;gap:12px}.choice-btn{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-radius:16px;border:1px solid var(--ra-border);background:var(--ra-soft-white);cursor:pointer;transition:border-color .2s ease,transform .2s ease,box-shadow .2s ease,background .2s ease}.choice-btn span{display:block;font-size:.85rem;color:var(--ra-muted)}.choice-btn strong{font-size:.98rem;color:var(--ra-text)}.choice-btn:hover,.choice-btn:focus-visible{border-color:var(--ra-border-strong);transform:translateY(-1px);box-shadow:0 14px 32px var(--ra-cream-shadow)}.choice-btn.selected{border-color:var(--ra-accent);box-shadow:0 0 0 4px var(--ra-cream-glow);background:var(--ra-bg-card)}.results-summary{display:grid;gap:18px}.diagnosis-card{display:grid;grid-template-columns:auto 1fr;gap:14px;padding:20px;border-radius:20px;border:1px solid var(--ra-border);background:var(--ra-bg-soft);position:relative;box-shadow:0 12px 26px #3c24120f}.diagnosis-card[data-tone=warning]{border-color:#ffb74db3;background:#fff2de}.diagnosis-card[data-tone=critical]{border-color:#ff8c70b3;background:#ffe7de}.diagnosis-card[data-tone=success]{border-color:#98de8bb3;background:#f2fbe9}.diagnosis-icon{font-size:2rem;line-height:1}.diagnosis-card h4{margin:0;font-size:1.1rem;font-weight:700;color:#0f172a}.diagnosis-card p{margin:6px 0 0;color:var(--ra-muted);font-size:.94rem}.diagnosis-card .source{margin-top:8px;font-size:.8rem;color:#7a6251bf}.score-pill{position:absolute;top:16px;right:16px;padding:6px 12px;border-radius:999px;font-weight:700;font-size:.8rem;background:#ff6b001f;color:var(--ra-accent)}.overall-score{padding:18px;border-radius:16px;background:var(--ra-bg-card);border:1px solid var(--ra-border);box-shadow:0 12px 28px var(--ra-cream-shadow);display:flex;flex-direction:column;gap:6px}.overall-score strong{font-size:1.15rem}.cta-grid{display:grid;gap:14px;margin-top:20px}.cta-card{display:grid;gap:18px;padding:20px;border-radius:20px;border:1px solid var(--ra-border);background:var(--ra-bg-card);box-shadow:0 14px 34px #ff8c402e}.cta-card .cta-intro{display:flex;align-items:center;gap:14px}.cta-icon-pill{display:inline-flex;align-items:center;justify-content:center;width:48px;height:48px;border-radius:16px;background:var(--ra-bg-soft);border:1px solid var(--ra-border);color:var(--ra-accent);font-size:1.45rem;flex-shrink:0}.cta-card .cta-copy{display:grid;gap:6px}.cta-card h5{margin:0;font-size:1.02rem;color:var(--ra-text)}.cta-card p{margin:0;font-size:.9rem;color:var(--ra-muted)}.cta-card .lead-copy{font-size:.9rem;color:var(--ra-muted)}.cta-card[data-lead-status=success]{box-shadow:0 12px 30px #78c76333}.link-cta{justify-self:flex-start;padding:0;border:none;font-weight:700;color:var(--ra-accent);text-decoration:underline;background:transparent}.link-cta:hover,.link-cta:focus-visible{color:var(--ra-accent-dark);transform:translate(2px)}.lead-form{display:grid;gap:16px}.form-grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(210px,1fr))}.form-grid label{display:grid;gap:6px;font-size:.85rem;color:var(--ra-muted)}.form-grid input{border:1px solid var(--ra-border);border-radius:14px;padding:12px 14px;background:var(--ra-soft-white);color:var(--ra-text);transition:border-color .2s ease,box-shadow .2s ease,background .2s ease;width:100%}.form-grid input:hover{border-color:var(--ra-border-strong);box-shadow:0 0 0 4px var(--ra-cream-glow)}.form-grid input[readonly]{background:#fff7f2e6;cursor:not-allowed}.lead-form .primary-btn{justify-self:flex-start}.lead-feedback{display:flex;align-items:center;gap:12px;border-radius:16px;border:1px solid var(--ra-border);background:var(--ra-bg-soft);padding:12px 14px;font-size:.9rem;color:var(--ra-text)}.lead-feedback.error{border-color:#ff8c70b3;background:#ffe7de;color:#a13a22}.feedback-icon{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:10px;background:#ff6b001f;color:var(--ra-accent);font-weight:700}.lead-feedback.error .feedback-icon{background:#ff8c7033;color:#a13a22}.modal footer{padding:20px 32px 26px;border-top:1px solid var(--ra-border);background:var(--ra-bg-soft);display:flex;justify-content:space-between;align-items:center;gap:12px;font-size:.85rem;color:var(--ra-muted)}.footer-reminder{font-weight:600;color:var(--ra-text)}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}@keyframes slideIn{0%{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 600px){.widget-card{padding:24px}.widget-card h3{font-size:1.25rem}.modal{width:100%;max-height:100vh;border-radius:0}.modal header,.modal main,.modal footer{padding-left:22px;padding-right:22px}.modal header{padding-top:24px}.modal-close{right:12px}.categories-grid{grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}.question-body{padding:22px}.cta-card{padding:18px}.lead-form .primary-btn{width:100%;justify-content:center}.form-grid{grid-template-columns:1fr}}',P=(e={})=>e.apiBase||"https://romandeassure.ch/api";async function ee(e={},c={}){const d=`${P(e)}/insurances/checkup`,u={"Content-Type":"application/json"};e.apiKey&&(u["X-API-Key"]=e.apiKey);try{return(await fetch(d,{method:"POST",headers:u,body:JSON.stringify(c)})).ok}catch(f){return console.error("RA widget – submitCheckup failed",f),!1}}async function ae(e={},c={}){const d=`${P(e)}/insurances/leads`,u={"Content-Type":"application/json"};e.apiKey&&(u["X-API-Key"]=e.apiKey);try{return(await fetch(d,{method:"POST",headers:u,body:JSON.stringify(c)})).ok}catch(f){return console.error("RA widget – submitLead failed",f),!1}}const _={auto:{label:"Assurance Auto",icon:"🚗",savings:400,ctaLabel:"Planifier un rappel auto",ctaUrl:"https://romandeassure.ch/fr/assurance-auto",source:"Source : lesfurets.com",leadCopy:"Un conseiller Romande Assure vous aide à verrouiller le meilleur tarif auto.",leadSuccess:"Merci ! Un expert auto vous contactera sous 24 h pour finaliser votre comparaison.",questions:[{id:"auto_last_review",title:"Depuis combien de temps n'avez-vous pas comparé votre assurance auto ?",subtitle:"Une mise à jour régulière vous protège contre les hausses silencieuses.",options:[{value:"less_1",label:"Moins d'1 an",detail:"Je suis à jour",score:5},{value:"1_3",label:"Entre 1 et 3 ans",detail:"Cela fait un moment",score:3},{value:"more_3",label:"Plus de 3 ans",detail:"Je n'ai jamais revu mon contrat",score:1}]},{id:"auto_satisfaction",title:"Êtes-vous satisfait du prix de votre assurance auto ?",subtitle:"Votre ressenti est un excellent signal pour déclencher une renégociation.",options:[{value:"yes",label:"Oui, tout va bien",detail:"Je pense être bien positionné",score:5},{value:"unsure",label:"Je ne sais pas",detail:"Je n'ai pas comparé récemment",score:3},{value:"no",label:"Non, je paie trop",detail:"Je soupçonne un tarif élevé",score:1}]}],evaluate:e=>{const c=e.auto_last_review,i=e.auto_satisfaction;return c==="less_1"&&i==="yes"?{tone:"success",headline:"Bravo, vous gardez votre contrat auto sous contrôle ✅",message:"Continuez à comparer chaque année pour ne jamais manquer une opportunité. Une vigilance régulière évite les hausses surprises."}:c==="more_3"||i==="no"?{tone:"critical",headline:"Votre assurance auto mérite une comparaison immédiate ! ⚠️",message:"Les automobilistes qui relancent leurs comparatifs économisent en moyenne ~400 € par an. Plus vous attendez, plus la facture grimpe. Ne laissez pas ces économies filer."}:{tone:"warning",headline:"Un check-up auto peut débloquer plusieurs centaines d'euros",message:"Si votre contrat a plus d'un an, une comparaison maintenant peut dégager jusqu'à 400 € d'économies annuelles. Prenez 2 minutes pour valider que vous êtes bien couvert."}}},habitation:{label:"Assurance Habitation",icon:"🏡",savings:450,ctaLabel:"Planifier un rappel habitation",ctaUrl:"https://romandeassure.ch/fr/assurance-habitation",source:"Source : echangesassurances.org",leadCopy:"Nos conseillers ajustent votre couverture habitation sans stress.",leadSuccess:"Merci ! Un expert habitation vous rappelle rapidement pour optimiser votre contrat.",questions:[{id:"home_last_review",title:"Quand avez-vous renégocié votre assurance habitation pour la dernière fois ?",subtitle:"Les garanties évoluent, vos besoins aussi.",options:[{value:"less_1",label:"Cette année",detail:"Je viens de comparer",score:5},{value:"1_2",label:"Il y a 1 à 2 ans",detail:"Un rafraîchissement ne ferait pas de mal",score:3},{value:"more_2",label:"Plus de 2 ans",detail:"Je n'ai rien changé depuis longtemps",score:1}]},{id:"home_satisfaction",title:"Êtes-vous satisfait du niveau de couverture et du prix ?",subtitle:"Un contrat trop cher ou mal calibré coûte cher en cas de sinistre.",options:[{value:"yes",label:"Oui, je suis serein",detail:"Mon prix est cohérent",score:5},{value:"unsure",label:"Je ne sais pas",detail:"Je n'ai jamais regardé en détail",score:2},{value:"no",label:"Non, je doute",detail:"Je crains de payer trop",score:1}]}],evaluate:e=>{const c=e.home_last_review,i=e.home_satisfaction;return c==="less_1"&&i==="yes"?{tone:"success",headline:"Votre couverture habitation est bien tenue 👏",message:"Restez attentif aux évolutions de valeur de vos biens et programmez une vérification annuelle pour conserver vos avantages."}:c==="more_2"||i==="no"?{tone:"critical",headline:"Votre logement peut cacher 450 € d'économies potentielles",message:"Les propriétaires qui renégocient leur assurance habitation économisent en moyenne 450 € la première année. Actualisez votre contrat pour ne plus surpayer."}:{tone:"warning",headline:"Bonne idée de revisiter votre assurance habitation",message:"Une mise à jour rapide sécurise vos biens et peut alléger la facture. Comparez les offres pour vérifier si votre budget est optimisé."}}},sante:{label:"Assurance Santé (LAMal)",icon:"🩺",savings:416,ctaLabel:"Accéder au comparateur LAMal",ctaUrl:"https://romandeassure.ch/fr/comparateur-lamal",source:"Sources : echangesassurances.org & lesfurets.com",questions:[{id:"health_compare",title:"Avez-vous comparé les primes de votre caisse maladie cette année ?",subtitle:"Les primes évoluent tous les ans : rester immobile coûte cher.",options:[{value:"yes",label:"Oui, récemment",detail:"Je suis les primes de près",score:5},{value:"plan",label:"C'est prévu bientôt",detail:"Je dois encore le faire",score:3},{value:"no",label:"Non, pas encore",detail:"Je n'ai pas eu le temps",score:1}]},{id:"health_priority",title:"Quel est votre objectif principal ?",subtitle:"Indiquez votre priorité pour adapter la recommandation.",options:[{value:"price",label:"Réduire ma prime",detail:"Je veux payer moins",score:1},{value:"coverage",label:"Améliorer ma couverture",detail:"Je cherche de meilleures garanties",score:3},{value:"stability",label:"Trouver un équilibre",detail:"Je veux optimiser prix + service",score:4}]}],evaluate:e=>{const c=e.health_compare;return c==="yes"?{tone:"success",headline:"Vous maîtrisez vos primes santé 🎯",message:"Continuez à challenger votre caisse chaque automne. Quelques minutes suffisent pour confirmer que vous payez le juste prix."}:c==="no"?{tone:"critical",headline:"Votre caisse maladie peut coûter des centaines de francs de trop",message:"Moins de 15 % des assurés comparent chaque année alors que les économies peuvent dépasser 400 CHF. Lancez une comparaison pour reprendre la main."}:{tone:"warning",headline:"Dernière ligne droite pour valider vos primes santé",message:"Comparer maintenant permet souvent d'économiser plusieurs centaines de francs sans sacrifier votre couverture. Ne laissez pas passer la prochaine échéance."}}}},U=Object.entries(_),D="sante",te="/fr/comparateur-lamal",re={ui_style:"soft-card",aura:"blue",variant:"capture-like"},se=`
<div class="ra360">
  <article class="widget-card" data-role="card" tabindex="0" aria-haspopup="dialog" aria-controls="ra-modal">
    <div class="card-icon-trio" aria-hidden="true">
      <span class="icon-pill"><span>🚗</span></span>
      <span class="icon-pill"><span>🏡</span></span>
      <span class="icon-pill"><span>🩺</span></span>
    </div>
    <h3>Bilan sérénité de vos assurances</h3>
    <p class="card-subtitle">Identifiez en douceur vos marges d'économies sur l'auto, l'habitation et LAMal.</p>
    <div class="cta-inline">Commencer le bilan maintenant <span aria-hidden="true">→</span></div>
  </article>
  <div class="modal-backdrop" data-modal hidden>
    <div class="modal" id="ra-modal" role="dialog" aria-modal="true" aria-labelledby="ra-modal-title">
      <button class="modal-close" data-close aria-label="Fermer le diagnostic">×</button>
      <header>
        <h2 id="ra-modal-title">Bilan express de vos assurances 📊</h2>
        <p>Répondez à quelques questions pour découvrir où vous pourriez économiser jusqu'à 1 000 € par an.</p>
        <div class="progress-bar"><span data-progress-bar></span></div>
        <div class="progress-label" data-progress-label>Étape 1 sur 4</div>
      </header>
      <main>
        <section class="step active" data-step="categories">
          <p>Sélectionnez les assurances que vous souhaitez analyser. Vous pouvez en choisir plusieurs.</p>
          <div class="categories-grid" data-categories></div>
          <div class="step-actions">
            <button type="button" class="primary-btn" data-action="start" disabled>Commencer le diagnostic</button>
          </div>
        </section>
        <section class="step" data-step="question">
          <div class="question-header">
            <div data-question-context></div>
            <div data-question-progress></div>
          </div>
          <div class="question-body">
            <h3 data-question-title></h3>
            <p data-question-subtitle></p>
            <div class="question-options" data-question-options></div>
          </div>
          <div class="step-actions">
            <button type="button" class="secondary-btn" data-action="back">Retour</button>
          </div>
        </section>
        <section class="step" data-step="results">
          <div class="overall-score">
            <strong data-overall-score></strong>
            <span data-overall-text></span>
          </div>
          <div class="results-summary" data-results></div>
          <div class="step-actions">
            <button type="button" class="primary-btn" data-action="to-cta">Voir mes actions concrètes</button>
          </div>
        </section>
        <section class="step" data-step="actions">
          <div class="overall-score">
            <strong data-total-savings></strong>
            <span data-total-text></span>
          </div>
          <div class="cta-grid" data-cta-grid></div>
        </section>
      </main>
      <footer>
        <div class="footer-reminder">Ne laissez pas des centaines d'euros s'échapper 💡</div>
        <div>Processus 100 % gratuit – aucune obligation</div>
      </footer>
    </div>
  </div>
</div>
`,j=window.__raSentEvents||new Set;window.__raSentEvents=j;function h(e,c={},i=!0){try{if(!Array.isArray(window.dataLayer)||i&&j.has(e))return;window.dataLayer.push({event:e,...re,...c}),i&&j.add(e)}catch(d){console.error("RA widget – dataLayer push error",d)}}function oe(e){const i=Array.from(e.querySelectorAll('a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])')).filter(x=>!x.hasAttribute("disabled"));if(!i.length)return;const d=i[0],u=i[i.length-1],f=x=>{x.key==="Tab"&&(x.shiftKey?document.activeElement===d&&(x.preventDefault(),u.focus()):document.activeElement===u&&(x.preventDefault(),d.focus()))};e.__trapHandler=f,e.addEventListener("keydown",f)}function ne(e){e!=null&&e.__trapHandler&&(e.removeEventListener("keydown",e.__trapHandler),delete e.__trapHandler)}function ie(e){e.innerHTML=U.map(([c,i])=>`
    <button type="button" class="category-option" data-category="${c}" aria-pressed="false">
      <div class="category-icon">${i.icon}</div>
      <div>${i.label}</div>
      <span>Jusqu'à ${i.savings} ${c==="sante"?"CHF":"€"} d'économies</span>
    </button>
  `).join("")}function ce(){const e={};for(const[c,i]of U)e[c]=i.questions.reduce((d,u)=>{const f=Math.max(...u.options.map(x=>x.score));return d+f},0);return e}const le=ce();function de(e,c={}){e.innerHTML=se;const i=e.querySelector('[data-role="card"]'),d=e.querySelector("[data-modal]"),u=e.querySelector(".modal"),f=e.querySelectorAll("[data-close]"),x=e.querySelector("[data-progress-bar]"),V=e.querySelector("[data-progress-label]"),pe=Array.from(e.querySelectorAll(".step")),m=e.querySelector("[data-categories]"),A=e.querySelector('[data-action="start"]'),T=e.querySelector('[data-action="back"]'),Q=e.querySelector('[data-action="to-cta"]'),R=e.querySelector("[data-question-title]"),E=e.querySelector("[data-question-subtitle]"),y=e.querySelector("[data-question-options]"),J=e.querySelector("[data-question-context]"),N=e.querySelector("[data-question-progress]"),Y=e.querySelector("[data-results]"),B=e.querySelector("[data-overall-score]"),G=e.querySelector("[data-overall-text]"),F=e.querySelector("[data-total-savings]"),K=e.querySelector("[data-total-text]"),z=e.querySelector("[data-cta-grid]");ie(m);const a={categories:new Set,questionQueue:[],answers:{},scores:{},answerScores:{},currentStep:"categories",currentQuestionIndex:0,openedAt:null,questionStart:null,hasResults:!1,leadStatus:{},gtmSessionId:null},fe=()=>{var t;if(c!=null&&c.gtmSessionId)return c.gtmSessionId;try{const r=(window==null?void 0:window.google_tag_manager)||{};for(const o of Object.keys(r)){if(!o.startsWith("GTM-"))continue;const n=(t=r[o])==null?void 0:t.dataLayer;if(n!=null&&n.get){const s=n.get("gtm.sessionId");if(s)return s}}}catch(r){console.warn("RA widget – unable to read GTM session",r)}if(Array.isArray(window.dataLayer))for(let r=window.dataLayer.length-1;r>=0;r-=1){const o=window.dataLayer[r];if(o&&o["gtm.sessionId"])return o["gtm.sessionId"]}return null};a.gtmSessionId=fe();const be=()=>3+a.questionQueue.length,ge=()=>{switch(a.currentStep){case"categories":return 1;case"question":return 2+a.currentQuestionIndex;case"results":return a.questionQueue.length+2;case"actions":return a.questionQueue.length+3;default:return 1}},me=()=>{const t=Math.max(be(),4),r=Math.min(ge(),t),o=Math.max(8,Math.round(r/t*100));x&&(x.style.width=`${o}%`),V&&(V.textContent=`Étape ${r} sur ${t}`)},S=t=>{var r;if(a.currentStep=t,pe.forEach(o=>{o.classList.toggle("active",o.dataset.step===t)}),me(),t==="categories"){const o=m==null?void 0:m.querySelector("button");o==null||o.focus()}else t==="question"?(r=y==null?void 0:y.querySelector(".choice-btn.selected"))==null||r.focus():t==="results"&&e.querySelector('[data-action="to-cta"]').focus({preventScroll:!0})},W=()=>{a.categories.clear(),a.questionQueue=[],a.answers={},a.scores={},a.answerScores={},a.currentQuestionIndex=0,a.openedAt=null,a.questionStart=null,a.hasResults=!1,a.leadStatus={},m==null||m.querySelectorAll(".category-option").forEach(t=>{t.classList.remove("active"),t.setAttribute("aria-pressed","false")}),A.disabled=!0,Y.innerHTML="",B.textContent="",G.textContent="",F.textContent="",K.textContent="",z.innerHTML="",R.textContent="",E.textContent="",y.innerHTML="",J.textContent="",N.textContent="",S("categories")},X=()=>{d&&(d.hidden=!1,d.classList.add("open"),oe(u),a.openedAt=Date.now(),h("ra360_open",{opened_at:new Date().toISOString()},!1),setTimeout(()=>{var t;(t=m==null?void 0:m.querySelector("button"))==null||t.focus({preventScroll:!0})},50))},O=(t="close")=>{!d||!d.classList.contains("open")||(ne(u),d.classList.remove("open"),d.hidden=!0,a.hasResults||h("ra360_abandon",{step_abandon:a.currentStep},!1),W(),i==null||i.focus({preventScroll:!0}))},ve=()=>{a.questionQueue=[],a.categories.forEach(t=>{_[t].questions.forEach(o=>{a.questionQueue.push({category:t,question:o})})})},C=()=>{var v,g;const t=a.questionQueue[a.currentQuestionIndex];if(!t)return;const{category:r,question:o}=t,n=_[r];if(J&&(J.textContent=`${n.icon} ${n.label}`),R&&(R.textContent=o.title),E&&(E.textContent=o.subtitle||"",E.style.display=o.subtitle?"block":"none"),N){const p=a.currentQuestionIndex+1;N.textContent=`Question ${p} sur ${a.questionQueue.length}`}const s=(v=a.answers[r])==null?void 0:v[o.id];y.innerHTML=o.options.map(p=>`
      <button type="button" class="choice-btn${p.value===s?" selected":""}" data-value="${p.value}" data-score="${p.score}">
        <strong>${p.label}</strong>
        <span>${p.detail}</span>
      </button>
    `).join(""),Array.from(y.querySelectorAll(".choice-btn")).forEach(p=>{p.addEventListener("click",()=>{const w=p.dataset.value,q=Number(p.dataset.score||0);a.answers[r]={...a.answers[r]||{},[o.id]:w};const L=a.answerScores[r]||{},M=L[o.id]||0;a.answerScores[r]={...L,[o.id]:q},a.scores[r]=Math.max(0,(a.scores[r]||0)-M+q),y.querySelectorAll(".choice-btn").forEach(k=>k.classList.remove("selected")),p.classList.add("selected"),setTimeout(()=>{if(a.currentQuestionIndex+=1,a.currentQuestionIndex>=a.questionQueue.length){const k=Math.max(1,Math.round((Date.now()-(a.questionStart||Date.now()))/1e3));h("ra360_questions_completed",{nombre_questions:a.questionQueue.length,duree_completion:k}),ye()}else C()},180)})});const l=y.querySelector(".choice-btn.selected"),b=y.querySelector(".choice-btn");(g=l||b)==null||g.focus({preventScroll:!0})},xe=t=>{if(!t.length)return{score:0,text:""};const o=t.reduce((l,b)=>l+b.score,0)/t.length,n=Math.round(o*10)/10;let s="Plus le score est élevé, plus vos contrats sont sous contrôle.";return n<=3?s="Alerte : vos contrats nécessitent une action immédiate pour stopper l'hémorragie.":n<=6?s="Encore un petit effort pour sécuriser vos économies potentielles.":n>=8&&(s="Excellent réflexe ! Continuez à vérifier vos assurances régulièrement."),{score:n,text:s}},he=t=>{if(!z)return;const r=a.leadStatus||(a.leadStatus={}),o=a.gtmSessionId;z.innerHTML=t.map(n=>{const s=n.key===D,l=["cta-card",s?"is-lamal":"is-lead"],b=n.leadSuccess||"Merci ! Un conseiller vous contactera rapidement.",v=n.leadCopy||"Un expert Romande Assure vous rappelle pour affiner votre contrat en toute sérénité.";return`
      <article class="${l.join(" ")}" data-category="${n.key}">
        <div class="cta-intro">
          <div class="cta-icon-pill" aria-hidden="true"><span>${n.icon}</span></div>
          <div class="cta-copy">
            <h5>${n.label}</h5>
            <p>${n.ctaMessage}</p>
          </div>
        </div>
        ${s?`
          <button type="button" class="link-cta" data-cta-lamal data-url="${n.ctaUrl}">
            ${n.ctaLabel} <span aria-hidden="true">→</span>
          </button>
        `:`
          <p class="lead-copy">${v}</p>
          <form class="lead-form" data-service="${n.key}" novalidate>
            <input type="hidden" name="service" value="${n.key}">
            <div class="form-grid">
              <label>
                <span>Nom complet</span>
                <input type="text" name="name" placeholder="Votre nom" autocomplete="name" required>
              </label>
              <label>
                <span>Email ou téléphone</span>
                <input type="text" name="email_or_phone" placeholder="vous@exemple.ch / +41…" autocomplete="email" required>
              </label>
              <label>
                <span>NPA ou Canton</span>
                <input type="text" name="npa_or_canton" placeholder="1204 Genève" autocomplete="postal-code" required>
              </label>
              <label>
                <span>Service</span>
                <input type="text" name="service_label" value="${n.label}" readonly aria-readonly="true">
              </label>
            </div>
            <button type="submit" class="primary-btn" data-submit>${n.ctaLabel} <span aria-hidden="true">→</span></button>
          </form>
          <div class="lead-feedback success" data-lead-success hidden>
            <div class="feedback-icon" aria-hidden="true">✔</div>
            <p>${b}</p>
          </div>
          <div class="lead-feedback error" data-lead-error hidden>
            <div class="feedback-icon" aria-hidden="true">!</div>
            <p>Oups ! Impossible d'envoyer votre demande. Merci de réessayer.</p>
          </div>
        `}
      </article>
    `}).join(""),Array.from(z.querySelectorAll("[data-cta-lamal]")).forEach(n=>{n.addEventListener("click",()=>{const s=n.dataset.url;if(h("ra360_lamal_redirect",{service:D,destination:te},!1),s){const l=window.open(s,"_blank","noopener");l&&(l.opener=null)}})}),Array.from(z.querySelectorAll("form[data-service]")).forEach(n=>{const s=n.dataset.service,l=n.closest(".cta-card"),b=l==null?void 0:l.querySelector("[data-lead-success]"),v=l==null?void 0:l.querySelector("[data-lead-error]"),g=n.querySelector("[data-submit]"),p=w=>{l&&(l.dataset.leadStatus=w,w==="success"?(n.hidden=!0,b&&(b.hidden=!1),v&&(v.hidden=!0)):(n.hidden=!1,b&&(b.hidden=!0),v&&(v.hidden=w!=="error")))};r[s]==="success"&&p("success"),n.addEventListener("submit",async w=>{w.preventDefault(),v&&(v.hidden=!0);const q=new FormData(n),L=String(q.get("name")||"").trim(),M=String(q.get("email_or_phone")||"").trim(),k=String(q.get("npa_or_canton")||"").trim();if(!L||!M||!k){r[s]="error",p("error");return}const we=(g==null?void 0:g.textContent)||"";g&&(g.disabled=!0,g.textContent="Envoi en cours…");try{const I={service:s,user:{name:L,email_or_phone:M,npa_or_canton:k},source:"ra360_widget",variant:"capture-like",ui_style:"soft-card",aura:"blue"};o&&(I.gtm_session_id=o);const H=await ae(c,I);h("ra360_lead_submit",{service:s,submit_status:H?"success":"error"},!1),r[s]=H?"success":"error",p(H?"success":"error")}catch(I){console.error("RA widget – lead submit failed",I),r[s]="error",h("ra360_lead_submit",{service:s,submit_status:"error"},!1),p("error")}finally{g&&(g.disabled=!1,g.textContent=we)}})})},ye=async()=>{a.hasResults=!0;const t=a.categories.size?Array.from(a.categories).map(s=>{const l=_[s],b=l.evaluate(a.answers[s]||{}),v=a.scores[s]||0,g=le[s]||1,p=Math.max(0,Math.min(10,Math.round(v/g*10)));return{key:s,label:l.label,icon:l.icon,tone:b.tone,headline:b.headline,message:b.message,source:l.source,score:p,savings:l.savings,ctaLabel:l.ctaLabel,ctaUrl:l.ctaUrl,leadCopy:l.leadCopy,leadSuccess:l.leadSuccess,ctaMessage:`Débloquez jusqu'à ${l.savings}${s==="sante"?" CHF":" €"} d'économies potentielles`,answers:a.answers[s]||{}}}):[];Y.innerHTML=t.map(s=>`
      <article class="diagnosis-card" data-tone="${s.tone}">
        <div class="diagnosis-icon">${s.icon}</div>
        <div>
          <h4>${s.headline}</h4>
          <p>${s.message}</p>
          <p class="source">${s.source}</p>
        </div>
        <div class="score-pill">Score ${s.score}/10</div>
      </article>
    `).join("");const r=xe(t);B.textContent=`Score de vigilance assurance : ${r.score}/10`,G.textContent=r.text;const o=t.reduce((s,l)=>s+l.savings,0);F.textContent=`Potentiel d'économies estimé : jusqu'à ${o} € / CHF`,K.textContent="Additionnez auto, habitation et santé et vous atteignez facilement 1 000 € d'économies annuelles.",he(t);const n={assurances_selectionnees:Array.from(a.categories),reponses:a.answers,score_vigilance:r.score,estimation_economies_totales:o,source:c.source||"widgetPageAccueil",variant:"capture-like",ui_style:"soft-card",aura:"blue",timestamp:new Date().toISOString()};h("ra360_results_shown",{potential_savings:o,services:Array.from(a.categories),score_vigilance:r.score}),ee(c,n).then(s=>{h("ra360_payload_sent",{status:s?"success":"error"},!1)}).catch(()=>{h("ra360_payload_sent",{status:"error"},!1)}),S("results")};i==null||i.addEventListener("click",()=>X()),i==null||i.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),X())}),m==null||m.addEventListener("click",t=>{const r=t.target.closest(".category-option");if(!r)return;const o=r.dataset.category;_[o]&&(a.categories.has(o)?(a.categories.delete(o),r.classList.remove("active"),r.setAttribute("aria-pressed","false")):(a.categories.add(o),r.classList.add("active"),r.setAttribute("aria-pressed","true")),A.disabled=a.categories.size===0)}),A==null||A.addEventListener("click",()=>{if(!a.categories.size)return;ve(),a.currentQuestionIndex=0,a.questionStart=Date.now();const t=Array.from(a.categories);h("ra360_select",{services:t,count:t.length}),S("question"),C()}),T==null||T.addEventListener("click",()=>{a.currentStep==="question"?a.currentQuestionIndex===0?S("categories"):(a.currentQuestionIndex=Math.max(0,a.currentQuestionIndex-1),C()):a.currentStep==="results"&&(a.currentQuestionIndex=Math.max(0,a.questionQueue.length-1),S("question"),C())}),Q==null||Q.addEventListener("click",()=>{S("actions")}),d==null||d.addEventListener("click",t=>{t.target===d&&O("overlay")}),f.forEach(t=>t.addEventListener("click",()=>O("button"))),e.addEventListener("keydown",t=>{t.key==="Escape"&&O("escape")}),W()}function ue(e="#ra",c={}){const i=document.querySelector(e);if(!i)throw new Error(`RAWidget: selector not found: ${e}`);const d=i.shadowRoot||i.attachShadow({mode:"open"});let u=d.querySelector("style[data-ra-widget-style]");u||(u=document.createElement("style"),u.setAttribute("data-ra-widget-style",""),u.textContent=Z,d.appendChild(u));let f=d.querySelector("#ra");f||(f=document.createElement("div"),f.id="ra",d.appendChild(f)),de(f,c)}return $.init=ue,Object.defineProperty($,Symbol.toStringTag,{value:"Module"}),$}({});
