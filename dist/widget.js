var RA360Widget=function(T){"use strict";const te='@import"https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Manrope:wght@400;600;700&display=swap";:host{display:block;background:transparent}#ra{all:initial;--ra-text: #3d2a1f;--ra-muted: #7a6251;--ra-bg-card: #fff7f2;--ra-bg-soft: #fff1e8;--ra-border: #ffd8c2;--ra-border-strong: #ffb894;--ra-accent: #ff6b00;--ra-accent-dark: #e85d00;--ra-focus: rgba(77, 163, 255, .45);--ra-cream-shadow: rgba(255, 140, 64, .18);--ra-cream-glow: rgba(255, 107, 0, .16);--ra-overlay: rgba(0, 0, 0, .58);--ra-soft-white: #ffffff;font-family:Manrope,Inter,Segoe UI,system-ui,sans-serif;color:var(--ra-text);font-size:16px;line-height:1.5;width:100%;text-rendering:optimizeLegibility}#ra *,#ra *:before,#ra *:after{box-sizing:border-box}.ra360{position:relative;display:block;width:100%}.ra360 button{font-family:inherit;border-radius:14px;border:1px solid transparent;background:transparent;color:inherit;transition:box-shadow .25s ease,transform .25s ease,border-color .25s ease,background .25s ease}.ra360 button:focus-visible,.ra360 input:focus-visible,.ra360 select:focus-visible,.ra360 textarea:focus-visible{outline:3px solid var(--ra-focus);outline-offset:2px;box-shadow:0 0 0 4px #4da3ff26}.widget-card{position:relative;display:grid;justify-items:center;gap:14px;padding:28px 26px;border-radius:20px;border:1px solid var(--ra-border);background:var(--ra-bg-card);color:var(--ra-text);box-shadow:0 18px 40px var(--ra-cream-shadow);transition:transform .25s ease,box-shadow .25s ease;cursor:pointer;text-align:center}.widget-card:after{content:"";position:absolute;inset:0;border-radius:20px;border:2px solid transparent;transition:border-color .25s ease,box-shadow .25s ease}.widget-card:hover,.widget-card:focus-visible{transform:translateY(-4px);box-shadow:0 28px 56px #ff8c403d}.widget-card:focus-visible:after{border-color:#ff8c4073;box-shadow:0 0 0 6px #4da3ff38}.widget-card h3{margin:0;font-size:1.4rem;font-weight:700}.widget-card .card-subtitle{margin:0;font-size:.96rem;color:var(--ra-muted);max-width:28ch}.card-icon-trio{display:flex;gap:10px}.icon-pill{display:inline-flex;align-items:center;justify-content:center;width:46px;height:46px;border-radius:16px;background:var(--ra-bg-soft);border:1px solid var(--ra-border);color:var(--ra-accent);font-size:1.4rem}.widget-card .cta-inline{display:inline-flex;align-items:center;gap:6px;font-weight:700;color:var(--ra-accent);text-decoration:underline;text-decoration-thickness:2px;text-decoration-color:#ff6b008c}.modal-backdrop{position:fixed;inset:0;display:none;align-items:stretch;justify-content:stretch;padding:0;background:var(--ra-overlay);backdrop-filter:blur(8px);z-index:99999;overflow:hidden}.modal-backdrop:before{content:"";position:absolute;inset:0;background:radial-gradient(circle at center,#4da3ff2e,#0009 60%);pointer-events:none}.modal-backdrop.open{display:flex;animation:fadeIn .25s ease}.modal{width:100vw;min-width:100vw;height:100vh;min-height:100vh;height:100dvh;min-height:100dvh;max-width:none;max-height:none;background:var(--ra-soft-white);border-radius:0;border:none;box-shadow:none;display:flex;flex-direction:column;overflow:hidden;position:relative}.modal header,.modal main,.modal footer{width:100%;max-width:960px;margin:0 auto}.modal header{padding:26px 32px 20px;border-bottom:1px solid var(--ra-border);background:var(--ra-bg-soft)}.modal header h2{margin:0;font-size:1.45rem;font-weight:700;display:flex;align-items:center;gap:10px}.modal header p{margin:8px 0 0;color:var(--ra-muted);font-size:.96rem}.progress-bar{margin-top:18px;height:6px;width:100%;background:#ffd8c299;border-radius:999px;overflow:hidden}.progress-bar span{display:block;height:100%;width:0;background:linear-gradient(90deg,#ff9f4d,var(--ra-accent));border-radius:inherit;transition:width .35s ease}.progress-label{margin-top:8px;font-size:.9rem;color:var(--ra-muted);font-weight:600;text-align:right}.modal-close{position:absolute;top:16px;right:16px;width:40px;height:40px;border-radius:50%;border:1px solid var(--ra-border);background:#ffe6d2e6;color:var(--ra-accent);font-size:1.1rem;cursor:pointer;transition:background .2s ease,transform .2s ease}.modal-close:hover,.modal-close:focus-visible{background:#ffd6ba;transform:translateY(-1px)}.modal main{flex:1;overflow-y:auto;padding:28px 32px 32px;background:var(--ra-soft-white)}.step{display:none;animation:slideIn .35s ease}.step.active{display:block}.categories-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin:24px 0 20px}.category-option{position:relative;display:flex;flex-direction:column;gap:8px;padding:16px;border-radius:16px;border:1px solid var(--ra-border);background:var(--ra-bg-soft);color:inherit;text-align:left;font-weight:600;cursor:pointer;transition:transform .2s ease,border-color .2s ease,box-shadow .2s ease}.category-option .category-icon{font-size:1.8rem}.category-option span{font-size:.85rem;font-weight:500;color:var(--ra-accent)}.category-option.active{border-color:var(--ra-accent);background:var(--ra-bg-card);box-shadow:0 12px 30px var(--ra-cream-shadow);transform:translateY(-2px)}.category-option:focus-visible{outline:none;box-shadow:0 0 0 4px #4da3ff33}.primary-btn,.secondary-btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;border-radius:18px;padding:12px 26px;font-weight:700;cursor:pointer;border:1px solid transparent;transition:transform .2s ease,box-shadow .2s ease,background .2s ease,border-color .2s ease}.primary-btn{background:linear-gradient(180deg,#ff7a1a 0%,var(--ra-accent) 100%);color:#fff;border-color:var(--ra-border-strong);box-shadow:0 16px 34px #ff6b0047}.primary-btn:disabled{cursor:not-allowed;opacity:.55;box-shadow:none}.primary-btn:not(:disabled):hover,.primary-btn:not(:disabled):focus-visible{transform:translateY(-1px);box-shadow:0 20px 46px #ff6b005c}.secondary-btn{background:var(--ra-bg-soft);color:var(--ra-text);border-color:var(--ra-border)}.secondary-btn:hover,.secondary-btn:focus-visible{background:#ffe8da;box-shadow:0 10px 22px var(--ra-cream-shadow)}.step-actions{display:flex;flex-wrap:wrap;gap:12px;justify-content:flex-end;margin-top:28px}.question-header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:18px;color:var(--ra-muted);font-size:.95rem}.question-body{background:var(--ra-bg-card);border:1px solid var(--ra-border);border-radius:20px;padding:26px;display:grid;gap:18px;box-shadow:0 12px 28px var(--ra-cream-shadow)}.question-body h3{margin:0;font-size:1.18rem;color:var(--ra-text)}.question-options{display:grid;gap:12px}.choice-btn{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-radius:16px;border:1px solid var(--ra-border);background:var(--ra-soft-white);cursor:pointer;transition:border-color .2s ease,transform .2s ease,box-shadow .2s ease,background .2s ease}.choice-btn span{display:block;font-size:.85rem;color:var(--ra-muted)}.choice-btn strong{font-size:.98rem;color:var(--ra-text)}.choice-btn:hover,.choice-btn:focus-visible{border-color:var(--ra-border-strong);transform:translateY(-1px);box-shadow:0 14px 32px var(--ra-cream-shadow)}.choice-btn.selected{border-color:var(--ra-accent);box-shadow:0 0 0 4px var(--ra-cream-glow);background:var(--ra-bg-card)}.results-summary{display:grid;gap:18px}.diagnosis-card{display:grid;grid-template-columns:auto 1fr;gap:14px;padding:20px;border-radius:20px;border:1px solid var(--ra-border);background:var(--ra-bg-soft);position:relative;box-shadow:0 12px 26px #3c24120f}.diagnosis-card[data-tone=warning]{border-color:#ffb74db3;background:#fff2de}.diagnosis-card[data-tone=critical]{border-color:#ff8c70b3;background:#ffe7de}.diagnosis-card[data-tone=success]{border-color:#98de8bb3;background:#f2fbe9}.diagnosis-icon{font-size:2rem;line-height:1}.diagnosis-card h4{margin:0;font-size:1.1rem;font-weight:700;color:#0f172a}.diagnosis-card p{margin:6px 0 0;color:var(--ra-muted);font-size:.94rem}.diagnosis-card .source{margin-top:8px;font-size:.8rem;color:#7a6251bf}.score-pill{position:absolute;top:16px;right:16px;padding:6px 12px;border-radius:999px;font-weight:700;font-size:.8rem;background:#ff6b001f;color:var(--ra-accent)}.overall-score{padding:18px;border-radius:16px;background:var(--ra-bg-card);border:1px solid var(--ra-border);box-shadow:0 12px 28px var(--ra-cream-shadow);display:flex;flex-direction:column;gap:6px}.overall-score strong{font-size:1.15rem}.cta-grid{display:grid;gap:14px;margin-top:20px}.cta-card{display:grid;gap:18px;padding:20px;border-radius:20px;border:1px solid var(--ra-border);background:var(--ra-bg-card);box-shadow:0 14px 34px #ff8c402e}.cta-card .cta-intro{display:flex;align-items:center;gap:14px}.cta-icon-pill{display:inline-flex;align-items:center;justify-content:center;width:48px;height:48px;border-radius:16px;background:var(--ra-bg-soft);border:1px solid var(--ra-border);color:var(--ra-accent);font-size:1.45rem;flex-shrink:0}.cta-card .cta-copy{display:grid;gap:6px}.cta-card h5{margin:0;font-size:1.02rem;color:var(--ra-text)}.cta-card p{margin:0;font-size:.9rem;color:var(--ra-muted)}.cta-card .lead-copy{font-size:.9rem;color:var(--ra-muted)}.cta-card[data-lead-status=success]{box-shadow:0 12px 30px #78c76333}.link-cta{justify-self:flex-start;padding:0;border:none;font-weight:700;color:var(--ra-accent);text-decoration:underline;background:transparent}.link-cta:hover,.link-cta:focus-visible{color:var(--ra-accent-dark);transform:translate(2px)}.lead-form{display:grid;gap:16px}.form-grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(210px,1fr))}.form-grid label{display:grid;gap:6px;font-size:.85rem;color:var(--ra-muted)}.form-grid input{border:1px solid var(--ra-border);border-radius:14px;padding:12px 14px;background:var(--ra-soft-white);color:var(--ra-text);transition:border-color .2s ease,box-shadow .2s ease,background .2s ease;width:100%}.form-grid input:hover{border-color:var(--ra-border-strong);box-shadow:0 0 0 4px var(--ra-cream-glow)}.form-grid input[readonly]{background:#fff7f2e6;cursor:not-allowed}.lead-form .primary-btn{justify-self:flex-start}.lead-feedback{display:flex;align-items:center;gap:12px;border-radius:16px;border:1px solid var(--ra-border);background:var(--ra-bg-soft);padding:12px 14px;font-size:.9rem;color:var(--ra-text)}.lead-feedback.error{border-color:#ff8c70b3;background:#ffe7de;color:#a13a22}.feedback-icon{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:10px;background:#ff6b001f;color:var(--ra-accent);font-weight:700}.lead-feedback.error .feedback-icon{background:#ff8c7033;color:#a13a22}.modal footer{padding:20px 32px 26px;border-top:1px solid var(--ra-border);background:var(--ra-bg-soft);display:flex;justify-content:space-between;align-items:center;gap:12px;font-size:.85rem;color:var(--ra-muted)}.footer-reminder{font-weight:600;color:var(--ra-text)}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}@keyframes slideIn{0%{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 600px){.widget-card{padding:24px}.widget-card h3{font-size:1.25rem}.modal{width:100%;max-height:100vh;border-radius:0}.modal header,.modal main,.modal footer{padding-left:22px;padding-right:22px}.modal header{padding-top:24px}.modal-close{right:12px}.categories-grid{grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}.question-body{padding:22px}.cta-card{padding:18px}.lead-form .primary-btn{width:100%;justify-content:center}.form-grid{grid-template-columns:1fr}}',D=(t={})=>t.apiBase||"https://romandeassure.ch/api";async function ae(t={},c={}){const p=`${D(t)}/insurances/checkup`,f={"Content-Type":"application/json"};t.apiKey&&(f["X-API-Key"]=t.apiKey);try{return(await fetch(p,{method:"POST",headers:f,body:JSON.stringify(c)})).ok}catch(d){return console.error("RA widget â€“ submitCheckup failed",d),!1}}async function re(t={},c={}){const p=`${D(t)}/insurances/leads`,f={"Content-Type":"application/json"};t.apiKey&&(f["X-API-Key"]=t.apiKey);try{return(await fetch(p,{method:"POST",headers:f,body:JSON.stringify(c)})).ok}catch(d){return console.error("RA widget â€“ submitLead failed",d),!1}}const A={auto:{label:"Assurance Auto",icon:"ðŸš—",savings:400,ctaLabel:"Planifier un rappel auto",ctaUrl:"https://romandeassure.ch/fr/assurance-auto",source:"SourceÂ : lesfurets.com",leadCopy:"Un conseiller Romande Assure vous aide Ã  verrouiller le meilleur tarif auto.",leadSuccess:"MerciÂ ! Un expert auto vous contactera sous 24Â h pour finaliser votre comparaison.",questions:[{id:"auto_last_review",title:"Depuis combien de temps n'avez-vous pas comparÃ© votre assurance autoÂ ?",subtitle:"Une mise Ã  jour rÃ©guliÃ¨re vous protÃ¨ge contre les hausses silencieuses.",options:[{value:"less_1",label:"Moins d'1 an",detail:"Je suis Ã  jour",score:5},{value:"1_3",label:"Entre 1 et 3 ans",detail:"Cela fait un moment",score:3},{value:"more_3",label:"Plus de 3 ans",detail:"Je n'ai jamais revu mon contrat",score:1}]},{id:"auto_satisfaction",title:"ÃŠtes-vous satisfait du prix de votre assurance autoÂ ?",subtitle:"Votre ressenti est un excellent signal pour dÃ©clencher une renÃ©gociation.",options:[{value:"yes",label:"Oui, tout va bien",detail:"Je pense Ãªtre bien positionnÃ©",score:5},{value:"unsure",label:"Je ne sais pas",detail:"Je n'ai pas comparÃ© rÃ©cemment",score:3},{value:"no",label:"Non, je paie trop",detail:"Je soupÃ§onne un tarif Ã©levÃ©",score:1}]}],evaluate:t=>{const c=t.auto_last_review,i=t.auto_satisfaction;return c==="less_1"&&i==="yes"?{tone:"success",headline:"Bravo, vous gardez votre contrat auto sous contrÃ´le âœ…",message:"Continuez Ã  comparer chaque annÃ©e pour ne jamais manquer une opportunitÃ©. Une vigilance rÃ©guliÃ¨re Ã©vite les hausses surprises."}:c==="more_3"||i==="no"?{tone:"critical",headline:"Votre assurance auto mÃ©rite une comparaison immÃ©diateÂ ! âš ï¸",message:"Les automobilistes qui relancent leurs comparatifs Ã©conomisent en moyenne ~400Â â‚¬ par an. Plus vous attendez, plus la facture grimpe. Ne laissez pas ces Ã©conomies filer."}:{tone:"warning",headline:"Un check-up auto peut dÃ©bloquer plusieurs centaines d'euros",message:"Si votre contrat a plus d'un an, une comparaison maintenant peut dÃ©gager jusqu'Ã  400Â â‚¬ d'Ã©conomies annuelles. Prenez 2 minutes pour valider que vous Ãªtes bien couvert."}}},habitation:{label:"Assurance Habitation",icon:"ðŸ¡",savings:450,ctaLabel:"Planifier un rappel habitation",ctaUrl:"https://romandeassure.ch/fr/assurance-habitation",source:"SourceÂ : echangesassurances.org",leadCopy:"Nos conseillers ajustent votre couverture habitation sans stress.",leadSuccess:"MerciÂ ! Un expert habitation vous rappelle rapidement pour optimiser votre contrat.",questions:[{id:"home_last_review",title:"Quand avez-vous renÃ©gociÃ© votre assurance habitation pour la derniÃ¨re foisÂ ?",subtitle:"Les garanties Ã©voluent, vos besoins aussi.",options:[{value:"less_1",label:"Cette annÃ©e",detail:"Je viens de comparer",score:5},{value:"1_2",label:"Il y a 1 Ã  2 ans",detail:"Un rafraÃ®chissement ne ferait pas de mal",score:3},{value:"more_2",label:"Plus de 2 ans",detail:"Je n'ai rien changÃ© depuis longtemps",score:1}]},{id:"home_satisfaction",title:"ÃŠtes-vous satisfait du niveau de couverture et du prixÂ ?",subtitle:"Un contrat trop cher ou mal calibrÃ© coÃ»te cher en cas de sinistre.",options:[{value:"yes",label:"Oui, je suis serein",detail:"Mon prix est cohÃ©rent",score:5},{value:"unsure",label:"Je ne sais pas",detail:"Je n'ai jamais regardÃ© en dÃ©tail",score:2},{value:"no",label:"Non, je doute",detail:"Je crains de payer trop",score:1}]}],evaluate:t=>{const c=t.home_last_review,i=t.home_satisfaction;return c==="less_1"&&i==="yes"?{tone:"success",headline:"Votre couverture habitation est bien tenue ðŸ‘",message:"Restez attentif aux Ã©volutions de valeur de vos biens et programmez une vÃ©rification annuelle pour conserver vos avantages."}:c==="more_2"||i==="no"?{tone:"critical",headline:"Votre logement peut cacher 450Â â‚¬ d'Ã©conomies potentielles",message:"Les propriÃ©taires qui renÃ©gocient leur assurance habitation Ã©conomisent en moyenne 450Â â‚¬ la premiÃ¨re annÃ©e. Actualisez votre contrat pour ne plus surpayer."}:{tone:"warning",headline:"Bonne idÃ©e de revisiter votre assurance habitation",message:"Une mise Ã  jour rapide sÃ©curise vos biens et peut allÃ©ger la facture. Comparez les offres pour vÃ©rifier si votre budget est optimisÃ©."}}},sante:{label:"Assurance SantÃ© (LAMal)",icon:"ðŸ©º",savings:416,ctaLabel:"AccÃ©der au comparateur LAMal",ctaUrl:"https://romandeassure.ch/fr/comparateur-lamal",source:"SourcesÂ : echangesassurances.org & lesfurets.com",questions:[{id:"health_compare",title:"Avez-vous comparÃ© les primes de votre caisse maladie cette annÃ©eÂ ?",subtitle:"Les primes Ã©voluent tous les ans : rester immobile coÃ»te cher.",options:[{value:"yes",label:"Oui, rÃ©cemment",detail:"Je suis les primes de prÃ¨s",score:5},{value:"plan",label:"C'est prÃ©vu bientÃ´t",detail:"Je dois encore le faire",score:3},{value:"no",label:"Non, pas encore",detail:"Je n'ai pas eu le temps",score:1}]},{id:"health_priority",title:"Quel est votre objectif principalÂ ?",subtitle:"Indiquez votre prioritÃ© pour adapter la recommandation.",options:[{value:"price",label:"RÃ©duire ma prime",detail:"Je veux payer moins",score:1},{value:"coverage",label:"AmÃ©liorer ma couverture",detail:"Je cherche de meilleures garanties",score:3},{value:"stability",label:"Trouver un Ã©quilibre",detail:"Je veux optimiser prix + service",score:4}]}],evaluate:t=>{const c=t.health_compare;return c==="yes"?{tone:"success",headline:"Vous maÃ®trisez vos primes santÃ© ðŸŽ¯",message:"Continuez Ã  challenger votre caisse chaque automne. Quelques minutes suffisent pour confirmer que vous payez le juste prix."}:c==="no"?{tone:"critical",headline:"Votre caisse maladie peut coÃ»ter des centaines de francs de trop",message:"Moins de 15Â % des assurÃ©s comparent chaque annÃ©e alors que les Ã©conomies peuvent dÃ©passer 400Â CHF. Lancez une comparaison pour reprendre la main."}:{tone:"warning",headline:"DerniÃ¨re ligne droite pour valider vos primes santÃ©",message:"Comparer maintenant permet souvent d'Ã©conomiser plusieurs centaines de francs sans sacrifier votre couverture. Ne laissez pas passer la prochaine Ã©chÃ©ance."}}}},V=Object.entries(A),Y="sante",se="/fr/comparateur-lamal",oe={ui_style:"soft-card",aura:"blue",variant:"capture-like"},ne=`
<div class="ra360">
  <div class="modal-backdrop" data-modal hidden>
    <div class="modal" id="ra-modal" role="dialog" aria-modal="true" aria-labelledby="ra-modal-title">
      <button class="modal-close" data-close aria-label="Fermer le diagnostic">Ã—</button>
      <header>
        <h2 id="ra-modal-title">Bilan express de vos assurances ðŸ“Š</h2>
        <p>RÃ©pondez Ã  quelques questions pour dÃ©couvrir oÃ¹ vous pourriez Ã©conomiser jusqu'Ã  1â€¯000Â â‚¬ par an.</p>
        <div class="progress-bar"><span data-progress-bar></span></div>
        <div class="progress-label" data-progress-label>Ã‰tape 1 sur 4</div>
      </header>
      <main>
        <section class="step active" data-step="categories">
          <p>SÃ©lectionnez les assurances que vous souhaitez analyser. Vous pouvez en choisir plusieurs.</p>
          <div class="categories-grid" data-categories></div>
          <div class="step-actions">
            <button type="button" class="primary-btn" data-action="start" disabled>Commencer le diagnostic</button>
          </div>
        </section>
        <section class="step" data-step="question">
          <div class="question-header">
            <div data-question-context></div>
            <div data-question-progress></div>
          </div>
          <div class="question-body">
            <h3 data-question-title></h3>
            <p data-question-subtitle></p>
            <div class="question-options" data-question-options></div>
          </div>
          <div class="step-actions">
            <button type="button" class="secondary-btn" data-action="back">Retour</button>
          </div>
        </section>
        <section class="step" data-step="results">
          <div class="overall-score">
            <strong data-overall-score></strong>
            <span data-overall-text></span>
          </div>
          <div class="results-summary" data-results></div>
          <div class="step-actions">
            <button type="button" class="primary-btn" data-action="to-cta">Voir mes actions concrÃ¨tes</button>
          </div>
        </section>
        <section class="step" data-step="actions">
          <div class="overall-score">
            <strong data-total-savings></strong>
            <span data-total-text></span>
          </div>
          <div class="cta-grid" data-cta-grid></div>
        </section>
      </main>
      <footer>
        <div class="footer-reminder">Ne laissez pas des centaines d'euros s'Ã©chapper ðŸ’¡</div>
        <div>Processus 100Â % gratuit â€“ aucune obligation</div>
      </footer>
    </div>
  </div>
</div>
`,Q=window.__raSentEvents||new Set;window.__raSentEvents=Q;function x(t,c={},i=!0){try{if(!Array.isArray(window.dataLayer)||i&&Q.has(t))return;window.dataLayer.push({event:t,...oe,...c}),i&&Q.add(t)}catch(p){console.error("RA widget â€“ dataLayer push error",p)}}function ie(t){const i=Array.from(t.querySelectorAll('a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])')).filter(h=>!h.hasAttribute("disabled"));if(!i.length)return;const p=i[0],f=i[i.length-1],d=h=>{h.key==="Tab"&&(h.shiftKey?document.activeElement===p&&(h.preventDefault(),f.focus()):document.activeElement===f&&(h.preventDefault(),p.focus()))};t.__trapHandler=d,t.addEventListener("keydown",d)}function ce(t){t!=null&&t.__trapHandler&&(t.removeEventListener("keydown",t.__trapHandler),delete t.__trapHandler)}function le(t){t.innerHTML=V.map(([c,i])=>`
    <button type="button" class="category-option" data-category="${c}" aria-pressed="false">
      <div class="category-icon">${i.icon}</div>
      <div>${i.label}</div>
      <span>Jusqu'Ã  ${i.savings}Â ${c==="sante"?"CHF":"â‚¬"} d'Ã©conomies</span>
    </button>
  `).join("")}function de(){const t={};for(const[c,i]of V)t[c]=i.questions.reduce((p,f)=>{const d=Math.max(...f.options.map(h=>h.score));return p+d},0);return t}const ue=de();function pe(t,c={}){t.innerHTML=ne;const i=t.querySelector("[data-modal]"),p=t.querySelector(".modal"),f=t.querySelectorAll("[data-close]"),d=t.querySelector("[data-progress-bar]"),h=t.querySelector("[data-progress-label]"),be=Array.from(t.querySelectorAll(".step")),m=t.querySelector("[data-categories]"),z=t.querySelector('[data-action="start"]'),R=t.querySelector('[data-action="back"]'),J=t.querySelector('[data-action="to-cta"]'),O=t.querySelector("[data-question-title]"),C=t.querySelector("[data-question-subtitle]"),w=t.querySelector("[data-question-options]"),N=t.querySelector("[data-question-context]"),H=t.querySelector("[data-question-progress]"),B=t.querySelector("[data-results]"),F=t.querySelector("[data-overall-score]"),G=t.querySelector("[data-overall-text]"),K=t.querySelector("[data-total-savings]"),W=t.querySelector("[data-total-text]"),L=t.querySelector("[data-cta-grid]"),X=c.trigger||"#diag360",y=document.querySelector(X);let I=null;le(m);const e={categories:new Set,questionQueue:[],answers:{},scores:{},answerScores:{},currentStep:"categories",currentQuestionIndex:0,openedAt:null,questionStart:null,hasResults:!1,leadStatus:{},gtmSessionId:null},ge=()=>{var a;if(c!=null&&c.gtmSessionId)return c.gtmSessionId;try{const r=(window==null?void 0:window.google_tag_manager)||{};for(const o of Object.keys(r)){if(!o.startsWith("GTM-"))continue;const n=(a=r[o])==null?void 0:a.dataLayer;if(n!=null&&n.get){const s=n.get("gtm.sessionId");if(s)return s}}}catch(r){console.warn("RA widget â€“ unable to read GTM session",r)}if(Array.isArray(window.dataLayer))for(let r=window.dataLayer.length-1;r>=0;r-=1){const o=window.dataLayer[r];if(o&&o["gtm.sessionId"])return o["gtm.sessionId"]}return null};e.gtmSessionId=ge();const me=()=>3+e.questionQueue.length,ve=()=>{switch(e.currentStep){case"categories":return 1;case"question":return 2+e.currentQuestionIndex;case"results":return e.questionQueue.length+2;case"actions":return e.questionQueue.length+3;default:return 1}},he=()=>{const a=Math.max(me(),4),r=Math.min(ve(),a),o=Math.max(8,Math.round(r/a*100));d&&(d.style.width=`${o}%`),h&&(h.textContent=`Ã‰tape ${r} sur ${a}`)},q=a=>{var r;if(e.currentStep=a,be.forEach(o=>{o.classList.toggle("active",o.dataset.step===a)}),he(),a==="categories"){const o=m==null?void 0:m.querySelector("button");o==null||o.focus()}else a==="question"?(r=w==null?void 0:w.querySelector(".choice-btn.selected"))==null||r.focus():a==="results"&&t.querySelector('[data-action="to-cta"]').focus({preventScroll:!0})},Z=()=>{e.categories.clear(),e.questionQueue=[],e.answers={},e.scores={},e.answerScores={},e.currentQuestionIndex=0,e.openedAt=null,e.questionStart=null,e.hasResults=!1,e.leadStatus={},m==null||m.querySelectorAll(".category-option").forEach(a=>{a.classList.remove("active"),a.setAttribute("aria-pressed","false")}),z.disabled=!0,B.innerHTML="",F.textContent="",G.textContent="",K.textContent="",W.textContent="",L.innerHTML="",O.textContent="",C.textContent="",w.innerHTML="",N.textContent="",H.textContent="",q("categories")},ee=()=>{i&&(I=document.activeElement,i.hidden=!1,i.classList.add("open"),ie(p),e.openedAt=Date.now(),x("ra360_open",{opened_at:new Date().toISOString()},!1),setTimeout(()=>{var a;(a=m==null?void 0:m.querySelector("button"))==null||a.focus({preventScroll:!0})},50))},P=(a="close")=>{if(!i||!i.classList.contains("open"))return;ce(p),i.classList.remove("open"),i.hidden=!0,e.hasResults||x("ra360_abandon",{step_abandon:e.currentStep},!1),Z();const r=I&&document.contains(I)?I:y;r==null||r.focus({preventScroll:!0})},xe=()=>{e.questionQueue=[],e.categories.forEach(a=>{A[a].questions.forEach(o=>{e.questionQueue.push({category:a,question:o})})})},M=()=>{var v,g;const a=e.questionQueue[e.currentQuestionIndex];if(!a)return;const{category:r,question:o}=a,n=A[r];if(N&&(N.textContent=`${n.icon} ${n.label}`),O&&(O.textContent=o.title),C&&(C.textContent=o.subtitle||"",C.style.display=o.subtitle?"block":"none"),H){const u=e.currentQuestionIndex+1;H.textContent=`Question ${u} sur ${e.questionQueue.length}`}const s=(v=e.answers[r])==null?void 0:v[o.id];w.innerHTML=o.options.map(u=>`
      <button type="button" class="choice-btn${u.value===s?" selected":""}" data-value="${u.value}" data-score="${u.score}">
        <strong>${u.label}</strong>
        <span>${u.detail}</span>
      </button>
    `).join(""),Array.from(w.querySelectorAll(".choice-btn")).forEach(u=>{u.addEventListener("click",()=>{const S=u.dataset.value,k=Number(u.dataset.score||0);e.answers[r]={...e.answers[r]||{},[o.id]:S};const E=e.answerScores[r]||{},$=E[o.id]||0;e.answerScores[r]={...E,[o.id]:k},e.scores[r]=Math.max(0,(e.scores[r]||0)-$+k),w.querySelectorAll(".choice-btn").forEach(_=>_.classList.remove("selected")),u.classList.add("selected"),setTimeout(()=>{if(e.currentQuestionIndex+=1,e.currentQuestionIndex>=e.questionQueue.length){const _=Math.max(1,Math.round((Date.now()-(e.questionStart||Date.now()))/1e3));x("ra360_questions_completed",{nombre_questions:e.questionQueue.length,duree_completion:_}),Se()}else M()},180)})});const l=w.querySelector(".choice-btn.selected"),b=w.querySelector(".choice-btn");(g=l||b)==null||g.focus({preventScroll:!0})},ye=a=>{if(!a.length)return{score:0,text:""};const o=a.reduce((l,b)=>l+b.score,0)/a.length,n=Math.round(o*10)/10;let s="Plus le score est Ã©levÃ©, plus vos contrats sont sous contrÃ´le.";return n<=3?s="Alerte : vos contrats nÃ©cessitent une action immÃ©diate pour stopper l'hÃ©morragie.":n<=6?s="Encore un petit effort pour sÃ©curiser vos Ã©conomies potentielles.":n>=8&&(s="Excellent rÃ©flexe ! Continuez Ã  vÃ©rifier vos assurances rÃ©guliÃ¨rement."),{score:n,text:s}},we=a=>{if(!L)return;const r=e.leadStatus||(e.leadStatus={}),o=e.gtmSessionId;L.innerHTML=a.map(n=>{const s=n.key===Y,l=["cta-card",s?"is-lamal":"is-lead"],b=n.leadSuccess||"MerciÂ ! Un conseiller vous contactera rapidement.",v=n.leadCopy||"Un expert Romande Assure vous rappelle pour affiner votre contrat en toute sÃ©rÃ©nitÃ©.";return`
      <article class="${l.join(" ")}" data-category="${n.key}">
        <div class="cta-intro">
          <div class="cta-icon-pill" aria-hidden="true"><span>${n.icon}</span></div>
          <div class="cta-copy">
            <h5>${n.label}</h5>
            <p>${n.ctaMessage}</p>
          </div>
        </div>
        ${s?`
          <button type="button" class="link-cta" data-cta-lamal data-url="${n.ctaUrl}">
            ${n.ctaLabel} <span aria-hidden="true">â†’</span>
          </button>
        `:`
          <p class="lead-copy">${v}</p>
          <form class="lead-form" data-service="${n.key}" novalidate>
            <input type="hidden" name="service" value="${n.key}">
            <div class="form-grid">
              <label>
                <span>Nom complet</span>
                <input type="text" name="name" placeholder="Votre nom" autocomplete="name" required>
              </label>
              <label>
                <span>Email ou tÃ©lÃ©phone</span>
                <input type="text" name="email_or_phone" placeholder="vous@exemple.ch / +41â€¦" autocomplete="email" required>
              </label>
              <label>
                <span>NPA ou Canton</span>
                <input type="text" name="npa_or_canton" placeholder="1204 GenÃ¨ve" autocomplete="postal-code" required>
              </label>
              <label>
                <span>Service</span>
                <input type="text" name="service_label" value="${n.label}" readonly aria-readonly="true">
              </label>
            </div>
            <button type="submit" class="primary-btn" data-submit>${n.ctaLabel} <span aria-hidden="true">â†’</span></button>
          </form>
          <div class="lead-feedback success" data-lead-success hidden>
            <div class="feedback-icon" aria-hidden="true">âœ”</div>
            <p>${b}</p>
          </div>
          <div class="lead-feedback error" data-lead-error hidden>
            <div class="feedback-icon" aria-hidden="true">!</div>
            <p>OupsÂ ! Impossible d'envoyer votre demande. Merci de rÃ©essayer.</p>
          </div>
        `}
      </article>
    `}).join(""),Array.from(L.querySelectorAll("[data-cta-lamal]")).forEach(n=>{n.addEventListener("click",()=>{const s=n.dataset.url;if(x("ra360_lamal_redirect",{service:Y,destination:se},!1),s){const l=window.open(s,"_blank","noopener");l&&(l.opener=null)}})}),Array.from(L.querySelectorAll("form[data-service]")).forEach(n=>{const s=n.dataset.service,l=n.closest(".cta-card"),b=l==null?void 0:l.querySelector("[data-lead-success]"),v=l==null?void 0:l.querySelector("[data-lead-error]"),g=n.querySelector("[data-submit]"),u=S=>{l&&(l.dataset.leadStatus=S,S==="success"?(n.hidden=!0,b&&(b.hidden=!1),v&&(v.hidden=!0)):(n.hidden=!1,b&&(b.hidden=!0),v&&(v.hidden=S!=="error")))};r[s]==="success"&&u("success"),n.addEventListener("submit",async S=>{S.preventDefault(),v&&(v.hidden=!0);const k=new FormData(n),E=String(k.get("name")||"").trim(),$=String(k.get("email_or_phone")||"").trim(),_=String(k.get("npa_or_canton")||"").trim();if(!E||!$||!_){r[s]="error",u("error");return}const qe=(g==null?void 0:g.textContent)||"";g&&(g.disabled=!0,g.textContent="Envoi en coursâ€¦");try{const j={service:s,user:{name:E,email_or_phone:$,npa_or_canton:_},source:"ra360_widget",variant:"capture-like",ui_style:"soft-card",aura:"blue"};o&&(j.gtm_session_id=o);const U=await re(c,j);x("ra360_lead_submit",{service:s,submit_status:U?"success":"error"},!1),r[s]=U?"success":"error",u(U?"success":"error")}catch(j){console.error("RA widget â€“ lead submit failed",j),r[s]="error",x("ra360_lead_submit",{service:s,submit_status:"error"},!1),u("error")}finally{g&&(g.disabled=!1,g.textContent=qe)}})})},Se=async()=>{e.hasResults=!0;const a=e.categories.size?Array.from(e.categories).map(s=>{const l=A[s],b=l.evaluate(e.answers[s]||{}),v=e.scores[s]||0,g=ue[s]||1,u=Math.max(0,Math.min(10,Math.round(v/g*10)));return{key:s,label:l.label,icon:l.icon,tone:b.tone,headline:b.headline,message:b.message,source:l.source,score:u,savings:l.savings,ctaLabel:l.ctaLabel,ctaUrl:l.ctaUrl,leadCopy:l.leadCopy,leadSuccess:l.leadSuccess,ctaMessage:`DÃ©bloquez jusqu'Ã  ${l.savings}${s==="sante"?" CHF":" â‚¬"} d'Ã©conomies potentielles`,answers:e.answers[s]||{}}}):[];B.innerHTML=a.map(s=>`
      <article class="diagnosis-card" data-tone="${s.tone}">
        <div class="diagnosis-icon">${s.icon}</div>
        <div>
          <h4>${s.headline}</h4>
          <p>${s.message}</p>
          <p class="source">${s.source}</p>
        </div>
        <div class="score-pill">Score ${s.score}/10</div>
      </article>
    `).join("");const r=ye(a);F.textContent=`Score de vigilance assuranceÂ : ${r.score}/10`,G.textContent=r.text;const o=a.reduce((s,l)=>s+l.savings,0);K.textContent=`Potentiel d'Ã©conomies estimÃ©Â : jusqu'Ã  ${o}Â â‚¬ / CHF`,W.textContent="Additionnez auto, habitation et santÃ© et vous atteignez facilement 1â€¯000Â â‚¬ d'Ã©conomies annuelles.",we(a);const n={assurances_selectionnees:Array.from(e.categories),reponses:e.answers,score_vigilance:r.score,estimation_economies_totales:o,source:c.source||"widgetPageAccueil",variant:"capture-like",ui_style:"soft-card",aura:"blue",timestamp:new Date().toISOString()};x("ra360_results_shown",{potential_savings:o,services:Array.from(e.categories),score_vigilance:r.score}),ae(c,n).then(s=>{x("ra360_payload_sent",{status:s?"success":"error"},!1)}).catch(()=>{x("ra360_payload_sent",{status:"error"},!1)}),q("results")};y?(y.tabIndex<0&&(y.tabIndex=0),y.getAttribute("role")||y.setAttribute("role","button"),y.setAttribute("aria-haspopup","dialog"),y.setAttribute("aria-controls","ra-modal"),y.addEventListener("click",()=>ee()),y.addEventListener("keydown",a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),ee())})):console.warn(`RA widget â€“ trigger selector not found: ${X}`),m==null||m.addEventListener("click",a=>{const r=a.target.closest(".category-option");if(!r)return;const o=r.dataset.category;A[o]&&(e.categories.has(o)?(e.categories.delete(o),r.classList.remove("active"),r.setAttribute("aria-pressed","false")):(e.categories.add(o),r.classList.add("active"),r.setAttribute("aria-pressed","true")),z.disabled=e.categories.size===0)}),z==null||z.addEventListener("click",()=>{if(!e.categories.size)return;xe(),e.currentQuestionIndex=0,e.questionStart=Date.now();const a=Array.from(e.categories);x("ra360_select",{services:a,count:a.length}),q("question"),M()}),R==null||R.addEventListener("click",()=>{e.currentStep==="question"?e.currentQuestionIndex===0?q("categories"):(e.currentQuestionIndex=Math.max(0,e.currentQuestionIndex-1),M()):e.currentStep==="results"&&(e.currentQuestionIndex=Math.max(0,e.questionQueue.length-1),q("question"),M())}),J==null||J.addEventListener("click",()=>{q("actions")}),i==null||i.addEventListener("click",a=>{a.target===i&&P("overlay")}),f.forEach(a=>a.addEventListener("click",()=>P("button"))),t.addEventListener("keydown",a=>{a.key==="Escape"&&P("escape")}),Z()}function fe(t="#ra",c={}){const i=document.querySelector(t);if(!i)throw new Error(`RA360Widget: selector not found: ${t}`);const p=i.shadowRoot||i.attachShadow({mode:"open"});let f=p.querySelector("style[data-ra-widget-style]");f||(f=document.createElement("style"),f.setAttribute("data-ra-widget-style",""),f.textContent=te,p.appendChild(f));let d=p.querySelector("#ra");d||(d=document.createElement("div"),d.id="ra",p.appendChild(d)),pe(d,c)}return T.init=fe,Object.defineProperty(T,Symbol.toStringTag,{value:"Module"}),T}({});
